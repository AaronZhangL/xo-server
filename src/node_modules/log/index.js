import composeBackends from './backends/compose'
import consoleBackend from './backends/console'
import createMemoryBackend from './backends/create-memory'
import LEVELS from './levels'

// ===================================================================

// Store all logs in memory until a real backend is connected.
export let backend = composeBackends(
  consoleBackend,
  createMemoryBackend()
)

export const setBackend = newBackend => {
  backend = newBackend
}

// -------------------------------------------------------------------

function Logger (namespace) {
  this._namespace = namespace
}

for (const name in LEVELS) {
  const level = LEVELS[name]

  Logger.prototype[name.toLowerCase()] = function (message, data) {
    backend({
      data,
      level,
      namespace: this._namespace,
      message,
      time: Date.now()
    })
  }
}

const createLogger = namespace => new Logger(namespace)
export { createLogger as default }
