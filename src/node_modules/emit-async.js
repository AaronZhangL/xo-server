import map from 'lodash/map'

export default function emitAsync (event, ...args) {
  const errors = []
  const onError = error => {
    errors.push(error)
  }

  return Promise.all(map(
    this.listeners(event),
    listener => new Promise(resolve => {
      resolve(listener.apply(this, args))
    }).catch(onError)
  )).then(() => errors.length ? errors : undefined)
}
