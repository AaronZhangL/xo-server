import { dirname } from 'path'
import { mkdir, stat } from 'fs'
import { promisify } from 'promise-toolbox'

const simpleMkdirp = (path, cb) => mkdir(path, error => {
  if (!error) {
    return cb()
  }

  if (error.code === 'ENOENT') {
    return simpleMkdirp(dirname(path), error => error
      ? cb(error)
      : simpleMkdirp(path, cb)
    )
  }

  stat(path, (error, stats) => error || !stats.isDirectory()
    ? cb(error)
    : cb()
  )
})

export default promisify(simpleMkdirp)
